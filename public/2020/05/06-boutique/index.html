<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Build your own Kubernetes-based Boutique | What the Heptio?</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=Description content="So you want to captain your very own Kubernetes vessel... but don't know where to start? Look no further."><link rel=prev href=http://whattheheptio.com/2020/04/05-velero/><link rel=canonical href=http://whattheheptio.com/2020/05/06-boutique/><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><meta name=twitter:card content="summary"><meta name=twitter:title content="Build your own Kubernetes-based Boutique"><meta name=twitter:description content="So you want to captain your very own Kubernetes vessel... but don't know where to start? Look no further."><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Build your own Kubernetes-based Boutique","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/whattheheptio.com\/2020\/05\/06-boutique\/"},"image":{"@type":"ImageObject","url":"http:\/\/whattheheptio.com\/cover.png","width":800,"height":600},"genre":"posts","keywords":"Kubernetes, Google Cloud, Practical","wordcount":2664,"url":"http:\/\/whattheheptio.com\/2020\/05\/06-boutique\/","datePublished":"2020-05-30T22:13:36\u002b01:00","dateModified":"2020-06-03T14:06:18\u002b01:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"Tom Meadows","logo":{"@type":"ImageObject","url":"http:\/\/whattheheptio.com\/logo.png","width":127,"height":40}},"description":"So you want to captain your very own Kubernetes vessel... but don\u0027t know where to start? Look no further."}</script><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/css/lib/fontawesome-free/all.min.min.css><link rel=stylesheet href=/css/lib/animate/animate.min.min.css></head><body><script>window.isDark=(window.localStorage&&window.localStorage.getItem('theme'))==='dark';window.isDark&&document.body.classList.add('dark-theme');</script><div class=wrapper><nav class=navbar><div class=navbar-container><div class="navbar-header animated bounceIn"><a href=http://whattheheptio.com>What the Heptio?</a></div><div class=navbar-menu><a class=menu-item href=http://whattheheptio.com/posts>Posts</a>
<a class=menu-item href=http://whattheheptio.com/tags>Tags</a>
<a class=menu-item href=http://whattheheptio.com/categories>Categories</a>
<a class=menu-item href=http://whattheheptio.com/about>About</a>
<a href=javascript:void(0); class=theme-switch><i class="fas fa-adjust fa-rotate-180 fa-fw" title="Switch Theme"></i></a></div></div></nav><nav class=navbar-mobile><div class=navbar-container><div class=navbar-header><div class="navbar-header-title animated bounceIn"><a href=http://whattheheptio.com>What the Heptio?</a></div><div class=menu-toggle id=menu-toggle><span></span><span></span><span></span></div></div><div class=navbar-menu id=mobile-menu><a class=menu-item href=http://whattheheptio.com/posts>Posts</a>
<a class=menu-item href=http://whattheheptio.com/tags>Tags</a>
<a class=menu-item href=http://whattheheptio.com/categories>Categories</a>
<a class=menu-item href=http://whattheheptio.com/about>About</a>
<a href=javascript:void(0); class=theme-switch><i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a></div></div></nav><main class=main><div class=container><article class=post-warp><h1 class="post-title animated flipInX">Build your own Kubernetes-based Boutique</h1><div class=post-meta><div class=post-meta-main><a class=author href=http://whattheheptio.com rel=author><i class="fas fa-user-circle fa-fw"></i>Tom Meadows&nbsp;</a>
<span class=post-category>included in
<i class="far fa-folder fa-fw"></i><a href=http://whattheheptio.com/categories/tutorials/>Tutorials</a></span></div><div class=post-meta-other><i class="far fa-calendar-alt fa-fw"></i><time datetime=2020-05-30>2020-05-30</time>&nbsp;
<i class="fas fa-pencil-alt fa-fw"></i>about 2664 words&nbsp;
<i class="far fa-clock fa-fw"></i>13 min&nbsp;</div></div><div class=post-featured-image><img src=/images/loading.svg data-sizes=auto data-src=/img/06-boutique/boutique-banner.png alt="featured image" class=lazyload></div><div class=post-content><p>So you want to commandeer your very own kubernetes vessel&mldr; but don&rsquo;t know where to start? Look no further.</p><a class=post-dummy-target id=todays-post-anthem></a><h5>Todays Post Anthem</h5><div align=centre><iframe src=https://open.spotify.com/embed/track/37rKwjBHaZurlyPYy3Nqvz width=300 height=80 frameborder=0 allowtransparency=true allow=encrypted-media></iframe><p><em>hey, want to go microservice shopping?</em> ü§¶‚Äç‚ôÇÔ∏è</p><p>Okay, so I agree. Kubernetes is an exciting concept for those interested in the enterprise computing world and unless you&rsquo;ve been living under a rock for the past year, you have probably heard the name thrown around left, right and centre. In fact, this blog on its own does a pretty good job that. You then begin to delve into the documentation, which talks about the &lsquo;microservice architecture&rsquo; way of life and you start to think, &ldquo;What the Heptio? How am I meant to just quickly develop my own microservices for the sake of trying out this platform?". Well this is how I felt, but unfortunately I didn&rsquo;t stumble upon a blog post like this that will now show you a fun way that you can try the fundamentals out for yourself.</p><a class=post-dummy-target id=what-ingredients-do-i-need-for-this-exercise></a><h4>What ingredients do I need for this exercise?</h4><p>All that is required is a google account with either some free credit for <a href=https://cloud.google.com/free>Google Cloud</a>, or a bank card attached. Not to worry though, the cost over the time required for the exercise should be no more than $5. It would also be handy if you had your own unique domain name, but this isn&rsquo;t crucial.</p><figure><img src=/img/06-boutique/bargain.gif><figcaption><h4>If you're like me, value for money is key</h4></figcaption></figure><a class=post-dummy-target id=lets-deploy-an-online-boutique></a><h2>Let&rsquo;s deploy an Online Boutique</h2><p>Right, let&rsquo;s begin. The first ingredient that we require on this exciting journey to our publically available shop for the boutique lovers of the world, is a suitably named &lsquo;classy&rsquo; cluster.</p><figure><img src=/img/06-boutique/gke.png></figure><p>As mentioned in the introduction, we will be making use of Google Cloud and its infamous &lsquo;<a href=https://cloud.google.com/kubernetes-engine>Google Kubernetes Engine</a>'. Why Google you ask? Well, there are couple of reasons why I think this is a preferable choice for a beginner user:</p><ul><li>$300 free credit is redeemable from Google to use on their cloud services, so you can <code>kube</code> away to your hearts content for months before paying a penny.</li><li>GKE is the most &lsquo;beginner friendly&rsquo; and simple enterprise Kubernetes service out there at the moment. In my eyes, it&rsquo;s also the most reliable and finished version of the platform.</li><li>We could have used a local kubernetes distributions such as <a href=https://github.com/kubernetes/minikube>minikube</a> or <a href=https://github.com/kubernetes-sigs/kind>kind</a>, but these are not designed for production applications and miss out on some key features.</li></ul><a class=post-dummy-target id=install-gcloud-sdk></a><h3>Install GCloud-SDK</h3><p>Once you have access to the Google Gloud console using your Google Account, the next step will be to create a project in the UI and to <a href=https://cloud.google.com/sdk/install>install and setup the GCloud-SDK</a> from the terminal on your machine. This will allow us to configure Google Cloud projects from the CLI; a handy tool when provisioning your first cluster. Once the install has completed, you should be able to type <code>gcloud init</code>, to connect to your Google account and select the project you made earlier.</p><p>Oh, I almost forgot; you&rsquo;ll also need <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl/><code>kubectl</code></a>. This is a simple binary that will allow us to interact with the kubernetes clusters that we have access to. This is somewhat of the communication layer that you will use for your cluster, once it has been provisioned. One other tool that may also be useful is <a href=https://github.com/ahmetb/kubectx><code>kubectx</code></a>, which will allow you to switch between kubernetes namespaces with the <code>kubens</code> command and the cluster that you want to control, with <code>kubectx</code>. Feel free to give it a try!</p><figure><img src=/img/06-boutique/kubens.gif></figure><a class=post-dummy-target id=provision-that-cluster-></a><h3>Provision that Cluster üöÄ</h3><p>It is now the moment we have all been waiting for. We have a Google project to host our boutique, as well as a cli to interface with it. We are now at the stage where our cluster is ready to be born out of the fires of the Google data centre.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>gcloud services enable container.googleapis.com
# enable the Google Kubernetes Engine service
gcloud container clusters create classy-cluster \
    --enable-autoupgrade \
    --enable-autoscaling --min-nodes=3 --max-nodes=10 \
    --num-nodes=5 --zone=us-central1-a
# press the big red button, declaring lift-off!
</code></pre></td></tr></table></div></div><script id=asciicast-VOIxw3ECwpqDNwNw3uIWL0Sle src=https://asciinema.org/a/VOIxw3ECwpqDNwNw3uIWL0Sle.js async data-autoplay=true data-size=small cols=100></script><p>Above you can see the output you should see in your terminal window upon calling these commands (I can only apologise for the scaling, but it shows you what to expect). As you can see, it finishes with the output of <code>kubeconfig entry generated for classy-cluster</code>. Fantastic news! Your cluster should now be addressable with the <code>kubectl get nodes</code> command, which lists the 5 nodes that we created. We&rsquo;re off to the races.</p><figure><img src=/img/06-boutique/rumble.gif><figcaption><h4>Let's get ready to kubectlllll</h4></figcaption></figure><a class=post-dummy-target id=time-to-get-boujie></a><h3>Time to get Boujie</h3><figure><img src=/img/06-boutique/boutique.svg></figure><p>Earlier in the post, I referred to an &lsquo;<a href=https://github.com/GoogleCloudPlatform/microservices-demo/>Online Boutique</a>', that is deployable on Kubernetes with a few simple steps. Well, this is in fact a demo application for Kubernetes, consisting of no less than 10 separate microservices. Once deployed, you can use the app to browse through some imaginary items, before adding them to a cart and purchasing. The best part is that on GKE, it is super easy to deploy, which makes it perfect for learning purposes.</p><figure><img src=/img/06-boutique/architecture.png><figcaption><h4>What the boutique looks like under the hood.</h4></figcaption></figure><p>In order to deploy this application, we must first perform a <code>git clone</code> of the github repository, so that we can save a copy of the required kubernetes manifests. This file, written in <a href=https://blog.stackpath.com/yaml/>yaml</a>, instructs to the kubernetes api-server which containers to run, where it can find them, as well as a selection of other parameters such as the ports to be used for the services, the resource requests/limits (cpu and memory) and much more. After cloning, navigate to the &lsquo;release&rsquo; directory, and open the <code>kubernetes-manifests.yaml</code> file, to take a look at the many kinds of declarations it features. This is the file we will be passing to the cluster with kubectl in a moment, so keep hold of it.</p><p>Now that we have our manifests at the ready, we must now create a <a href=https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/>namespace</a>. These are siphoned off areas of the cluster, intended to organise separate clusters and development teams that are working at the same time. liken them to rooms in a building, or sections in a library. By calling <code>kubectl create namespace boutique</code>, we can create a special little place for our application to sit. If you installed the <code>kubectx</code> application, the <code>kubens</code> command will come in handy here (e.g. <code>kubens boutique</code>). Otherwise, you can type something like <code>kubectl config set-context --current --namespace=boutique</code>, to switch to the <code>boutique</code> namespace using <code>kubectl</code>.</p><p>Finally, let&rsquo;s go ahead and deploy our application on the cluster with the following command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>kubectl apply -f kubernetes-manifests.yaml 
# and we&#39;re off!
</code></pre></td></tr></table></div></div><a class=post-dummy-target id=checking-that-were-golden></a><h3>Checking that we&rsquo;re Golden</h3><p>you should see a list of terminal outputs, informing you that the resources declared in the manifests are being created in the namespace that kubectl is looking at. The command <code>kubectl get pods</code> should bring up all the pods that have been deployed for our application. After a minute or so of the status showing <code>ContainerCreating</code>, they should be up and running.</p><p><strong>Warning:</strong> I experienced some issues with the <code>loadgenerator</code> pod, where it would get stuck in a <code>CrashLoopBackOff</code>, meaning that it was repeatedly crashing during intilisation. I resolved this by using <code>kubectl describe loadgenerator-&lt;unique-pod-id></code>, which gives some more information about the pod, before performing a <code>kubectl delete pod</code>, which will re-instantuate it. This brought the status to the <code>Running</code> state we are looking for.</p><a class=post-dummy-target id=lets-take-a-look-at-our-boutique></a><h3>Lets take a look at our Boutique!</h3><p>Now that we have all pods up and running, we can call <code>kubectl get services</code>, to take a look at the service objects created thanks to our manifest. In the list of objects that it gives back, you should notice a little service called <code>frontend-external</code>, with its <code>TYPE</code> set to <code>LoadBalancer</code>. It should also have an <code>EXTERNAL-IP</code> assigned to it. If it is set to <code>&lt;pending></code>, just be patient and use a <code>watch kubectl get service</code> command to wait for an IP to be presented to you. What is happening here is that the Kubernetes api-server is communicating with Googles load balancing service, asking for it to assign a unique IP address to this service endpoint. Pretty cool huh? You should now be able to use the <code>EXTERNAL-IP</code> provided to view your Boutique. Woo-hoo! We did it!</p><figure><img src=/img/06-boutique/storefront.png></figure><a class=post-dummy-target id=hey-check-out-my-store-at-35193255113-></a><h2>Hey, check out my store at 35.193.255.113 üò¨</h2><p><strong>Disclaimer: This section requires that you own a domain name that can be assigned to your cluster.</strong></p><p>Yeah, I agree; we&rsquo;re not really going to just give all our pals this IP address on the back of a napkin. Sure, it works&mldr; but it doesn&rsquo;t sound very &lsquo;boutiquey&rsquo; if you ask me. I hear you say, &lsquo;oh, we can just map the IP with an A record to my domain name on the DNS&rsquo;. Well, you would be correct, but I have a more effective &lsquo;kubernetes way&rsquo; to do this part. Introducing the beauty of &lsquo;Ingress&rsquo;.</p><p>This was discussed in the very <a href=https://whattheheptio.com/2020/02/first-posts/>first blog post</a> I made, so it may be worth going back and taking a look if you&rsquo;re interested. In esssence though, the ingress controller is a Kubernetes implementation that allows traffic to be directed to specific service endpoints on the cluster, based on parameters such as the domain and extension that has been entered by the user on the client end. This is very useful for handling a tonne of front-end services through one public facing load balancer (LB) IP address.</p><p>My ingress controller of choice is <a href=https://github.com/projectcontour/contour>Contour</a>, and can simply be deployed using the command below. We will also check that the pods for the deployment are running correctly, as well as list the service of the <code>envoy</code> daemonset, which is the heart of the contour operation.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>kubectl apply -f https://projectcontour.io/quickstart/contour.yaml
# deploy contour
kubectl -n projectcontour get pods
# check that the pods are running
kubectl get -n projectcontour service envoy
# list the envoy service, and its LB IP address
</code></pre></td></tr></table></div></div><p>When you call the final command, the public IP should be shown for envoy, which is where you want to point your domain name to. Once you have done this, typing <code>host my-k8s-boutique.net</code> with the respective domain should give back the IP of the envoy service. Bare in mind that this may take a little while to update, so don&rsquo;t get impatient like I often do!</p><p>Finally, we can create an ingress manifest, which declares an ingress resource for contour to take note of, giving it the information it needs in order for the traffic of our domain to be forwarded on to the service. A quick <code>kubectl -f boutique-ingress.yaml</code> should get this baby up and running. And as if by magic, we can view our boutique in the web browser through our domain! Now you can flex to your friends with your very own online boutique without repeating the IP to them 34 times. Even though you can&rsquo;t actually buy anything ü§£.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>apiVersion</span><span class=p>:</span><span class=w> </span>networking.k8s.io/v1beta1<span class=w>
</span><span class=w></span><span class=k>kind</span><span class=p>:</span><span class=w> </span>Ingress<span class=w>
</span><span class=w></span><span class=k>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>annotations</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>kubernetes.io/ingress.class</span><span class=p>:</span><span class=w> </span>contour<span class=w>
</span><span class=w>  </span><span class=k>name</span><span class=p>:</span><span class=w> </span>frontend-external<span class=w>
</span><span class=w>  </span><span class=k>labels</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>app</span><span class=p>:</span><span class=w> </span>frontend-external<span class=w>
</span><span class=w></span><span class=k>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>rules</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=k>host</span><span class=p>:</span><span class=w> </span>my-k8s-boutique.net<span class=w>   </span><span class=c># Change this to your domain!</span><span class=w>
</span><span class=w>  </span><span class=k>backend</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>serviceName</span><span class=p>:</span><span class=w> </span>frontend-external<span class=w>
</span><span class=w>    </span><span class=k>servicePort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></code></pre></td></tr></table></div></div><a class=post-dummy-target id=persistence-is-a-virtue></a><h2>Persistence is a Virtue</h2><p>So if you&rsquo;re still with me at this point, I applaud your efforts. While this is a fairly straight forward project, it is still a lot of content to take in at once.</p><p>While digging around our newly christened boutique store, you might have noticed the shopping basket. Sure, looks great; but what happens if the micro-service pod responsible for this functionality dies during a customer shopping spree. <strong>Remember</strong>, pods are designed to be ephemeral, meaning they are not expected to live very long. If you fill the basket with items and then carry out the command <code>kubectl delete pods -l app=redis-cart</code>, the boutique should show some error messages while a new &lsquo;redis-cart&rsquo; pod is being created, before becoming available again. But you&rsquo;ll notice, the items you added to the basket are now gone! How inconvenient.</p><p>This problem occurs because the pod has not been assigned a &lsquo;persistent-volume&rsquo; to store data that will survive the pods lifecycle. This is a resource that maps to a mountpoint on a physical disk such as <a href=https://cloud.google.com/kubernetes-engine/docs/concepts/persistent-volumes>Persistent Disks</a> that are used by Google Compute Engine (GCE). So how do we do this to ensure maximum boutiqueness? All that&rsquo;s needed is a short yaml file declaring a request for the storage object, followed by a reference to it in the original <code>kubernetes-manifests.yaml</code> file for the boutique.</p><p>The yaml below shows the persistent volume claim manifest. This is a request to a &lsquo;storage class&rsquo; provider to give the cluster some storage of a specified size. you can view the storage class providers by typing <code>kubectl get storageclasses</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>apiVersion</span><span class=p>:</span><span class=w> </span>v1<span class=w>
</span><span class=w></span><span class=k>kind</span><span class=p>:</span><span class=w> </span>PersistentVolumeClaim<span class=w>
</span><span class=w></span><span class=k>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>name</span><span class=p>:</span><span class=w> </span>redis-cart<span class=w>
</span><span class=w>  </span><span class=k>annotations</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>volume.beta.kubernetes.io/storage-class</span><span class=p>:</span><span class=w> </span>standard<span class=w>
</span><span class=w></span><span class=k>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>accessModes</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- ReadWriteOnce<span class=w>
</span><span class=w>  </span><span class=k>resources</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>requests</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>storage</span><span class=p>:</span><span class=w> </span>10Gi<span class=w>
</span></code></pre></td></tr></table></div></div><p>As you can see above, I have requested a persistent volume called &lsquo;redis-cart&rsquo;, using the storage class &lsquo;standard&rsquo;, which is the storage class installed by default in GKE for using Persistent Disks in GCE. The &lsquo;ReadWriteOnce&rsquo; declaration just means that it can only be mounted as read-write by a single node. This is the default mode and will work for this scenario. I have requested 10gb of storage, which is also plenty for this example. As usual, the <code>kubectl apply -f redis-cart-pvc.yaml</code> command is enough to get it attached to the cluster. We can check that the volume was created by checking for the <code>BOUND</code> status upon calling <code>kubectl get pvc</code>.</p><figure><img src=/img/06-boutique/persistentvolume.png><figcaption><h4>The persistent volume, as seen in the Google Cloud console</h4></figcaption></figure><p>Now to let the redis-cart deployment make use of this prime real-estate, we need to edit our original <code>kubernetes-manifests.yaml</code>. There are many objects in this file that we don&rsquo;t need to touch, but the section in question can be seen below, with the appropriate edits already in place. You will notice that at the bottom under <code>volumes:</code>, my yaml states a <code>persistentVolumeClaim</code>, as opposed to the original <code>EmptyDir</code>. This is where we need to set it to the name of our PV <code>redis-cart</code>, before saving the yaml file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=c>### Changes made to Redis Cart so cart data is saved to PV ###</span><span class=w>
</span><span class=w></span><span class=k>apiVersion</span><span class=p>:</span><span class=w> </span>apps/v1<span class=w>
</span><span class=w></span><span class=k>kind</span><span class=p>:</span><span class=w> </span>Deployment<span class=w>
</span><span class=w></span><span class=k>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>name</span><span class=p>:</span><span class=w> </span>redis-cart<span class=w>
</span><span class=w></span><span class=k>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>selector</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>matchLabels</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>app</span><span class=p>:</span><span class=w> </span>redis-cart<span class=w>
</span><span class=w>  </span><span class=k>template</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>labels</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>app</span><span class=p>:</span><span class=w> </span>redis-cart<span class=w>
</span><span class=w>    </span><span class=k>spec</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>containers</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>redis<span class=w>
</span><span class=w>        </span><span class=k>image</span><span class=p>:</span><span class=w> </span>redis<span class=p>:</span>alpine<span class=w>
</span><span class=w>        </span><span class=k>ports</span><span class=p>:</span><span class=w>
</span><span class=w>        </span>- <span class=k>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>6379</span><span class=w>
</span><span class=w>        </span><span class=k>readinessProbe</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=k>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span><span class=w>          </span><span class=k>tcpSocket</span><span class=p>:</span><span class=w>
</span><span class=w>            </span><span class=k>port</span><span class=p>:</span><span class=w> </span><span class=m>6379</span><span class=w>
</span><span class=w>        </span><span class=k>livenessProbe</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=k>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span><span class=w>          </span><span class=k>tcpSocket</span><span class=p>:</span><span class=w>
</span><span class=w>            </span><span class=k>port</span><span class=p>:</span><span class=w> </span><span class=m>6379</span><span class=w>
</span><span class=w>        </span><span class=k>volumeMounts</span><span class=p>:</span><span class=w>
</span><span class=w>        </span>- <span class=k>mountPath</span><span class=p>:</span><span class=w> </span>/data<span class=w>
</span><span class=w>          </span><span class=k>name</span><span class=p>:</span><span class=w> </span>redis-data<span class=w>
</span><span class=w>        </span><span class=k>resources</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=k>limits</span><span class=p>:</span><span class=w>
</span><span class=w>            </span><span class=k>memory</span><span class=p>:</span><span class=w> </span>256Mi<span class=w>
</span><span class=w>            </span><span class=k>cpu</span><span class=p>:</span><span class=w> </span>125m<span class=w>
</span><span class=w>          </span><span class=k>requests</span><span class=p>:</span><span class=w>
</span><span class=w>            </span><span class=k>cpu</span><span class=p>:</span><span class=w> </span>70m<span class=w>
</span><span class=w>            </span><span class=k>memory</span><span class=p>:</span><span class=w> </span>200Mi<span class=w>
</span><span class=w>      </span><span class=k>volumes</span><span class=p>:</span><span class=w>                  </span><span class=c># Where we want to edit!</span><span class=w>
</span><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>redis-data<span class=w>
</span><span class=w>        </span><span class=k>persistentVolumeClaim</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=k>claimName</span><span class=p>:</span><span class=w> </span>redis-cart<span class=w>
</span></code></pre></td></tr></table></div></div><p>Now finally we are ready to go ahead and call our final <code>kubectl apply -f kubernetes-manifests.yaml</code> to do what seemed unthinkable only minutes ago. You have now attached persistent storage to your redis cart! A quick call of <code>kubectl get pods</code> will show the pod in a running state. You can then add items to the basket and try deleting the pod. Once it comes back up, your redis database is back up off the canvas ü•ä.</p><a class=post-dummy-target id=finishing-up-dont-forget-to-delete-your-cluster></a><h2>Finishing Up (Don&rsquo;t forget to delete your cluster!)</h2><p>All I can say after that one hell of a slog is congratulations for completing your first ever boutique quality Kubernetes project! We have taken a look into what is required to front up a public-cloud based cluster, as well as the initial steps that are taken to deploy an application using <code>kubectl</code>, before making it publically available.</p><p>Now that we have come to the end of this post, you might want to delete the cluster to ensure you save your pennies for the next exciting run in with Google Cloud. If you want to take things a step further, I would suggest that you maybe look into securing your application with HTTPS traffic. For this you will need a TLS certificate, which can be achieved with ease, thanks to the <a href=https://github.com/jetstack/cert-manager>cert-manager</a> certificate management controller. Past that, you could maybe even take a look at creating a Grafana dashboard that monitors users navigating the site using <a href=https://whattheheptio.com/2020/03/04-prometheus/>Prometheus</a> to scrap metrics. Who knows, the world is your oyster!</p><p>So, without further ado, let me sign off for this latest post, wishing you all the best wherever you are. Oh yes, without forgetting the command to kill the cluster. Cheerio!</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>gcloud container clusters delete classy-cluster üëãüëãüëã
</code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>This article is updated with 2020-06-03</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=http://whattheheptio.com/2020/05/06-boutique/index.md target=_blank></a></span></div><div class=post-info-share><span><a href="//reddit.com/submit?url=http%3a%2f%2fwhattheheptio.com%2f2020%2f05%2f06-boutique%2f&title=Build%20your%20own%20Kubernetes-based%20Boutique" target=_blank title="Share on Reddit"><i class="fab fa-reddit fa-fw"></i></a><a href="//www.linkedin.com/shareArticle?url=http%3a%2f%2fwhattheheptio.com%2f2020%2f05%2f06-boutique%2f&title=Build%20your%20own%20Kubernetes-based%20Boutique" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin fa-fw"></i></a></span></div></div></div><div class=post-info-more><section><span class=tag><a href=http://whattheheptio.com/tags/kubernetes/><i class="fas fa-tag fa-fw"></i>Kubernetes</a></span>
<span class=tag><a href=http://whattheheptio.com/tags/google-cloud/><i class="fas fa-tag fa-fw"></i>Google Cloud</a></span>
<span class=tag><a href=http://whattheheptio.com/tags/practical/><i class="fas fa-tag fa-fw"></i>Practical</a></span></section><section><span><a href=javascript:window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=http://whattheheptio.com>Home</a></span></section></div><div class=post-nav><a href=http://whattheheptio.com/2020/04/05-velero/ class=prev rel=prev title="When disaster strikes, count on... Velero?"><i class="fas fa-angle-left fa-fw"></i>When disaster strikes, count on... Velero?</a></div></div><div class=post-comment><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")
return;var dsq=document.createElement("script");dsq.type="text/javascript";dsq.async=true;var disqus_shortname="whattheheptio";dsq.src="//"+disqus_shortname+".disqus.com/embed.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></main><footer class=footer><div class=copyright><div class=copyright-line>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreffer">Hugo</a>&nbsp;|&nbsp;Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="external nofollow noopener noreffer">LoveIt<i class="far fa-heart fa-fw"></i></a></div><div class=copyright-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=http://whattheheptio.com>Tom Meadows</a></span><span class=license>&nbsp;|&nbsp;<a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer><script src=/js/lib/jquery/jquery.slim.min.min.js></script><script src=/js/lib/lazysizes/lazysizes.min.min.js></script><script src=/js/lib/smooth-scroll/smooth-scroll.polyfills.min.min.js></script><script>window.scroll=new SmoothScroll('[data-scroll]',{speed:300,speedAsDuration:true});</script><script src=/js/blog.min.js></script></div><a href=# class=dynamic-to-top id=dynamic-to-top data-scroll><span>&nbsp;</span></a></body></html>